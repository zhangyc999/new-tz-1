```mermaid
graph TB
      开始((开始))-->构建缓冲链表
      构建缓冲链表-->硬件初始化
      硬件初始化-->主循环开始
      主循环开始-->延时
      延时-->状态正常{状态寄存器正常}
      状态正常--YES-->为空{消息队列为空}
      状态正常--NO-->重新初始化硬件
      重新初始化硬件-->主循环开始
      为空--YES-->已满{缓冲链表已满}
      为空--NO-->向总线发送
      向总线发送-->已满
      已满--YES-->小于10s{缓冲累积时间小于10s}
      已满--NO-->总线负载率正常
      小于10s--YES-->总线负载率过高
      小于10s--NO-->总线负载率正常
      总线负载率正常-->主循环开始
      总线负载率过高-->主循环开始
```

# 全局变量
| 序号 | 变量名 | 说明 |
| :-: | :-: | :- |
| 1 | p_can | CAN总线接收缓冲链表游标 |

# 函数定义

## void t_can(int period, int duration) {}

### 局部变量定义
| 序号 | 变量名 | 说明 |
| :-: | :-: | :- |
| 1 | recv | 数据来源的任务ID和接收数据的首地址 |
| 2 | i | 循环变量 |
| 3 | id | 中间变量存储ID（29位ID左对齐） |
| 4 | buf | CAN总线缓存数据及存储数量 |
| 5 | lst | 定义链表头 |
| 6 | delta | 链表缓冲累积时间差 |


### 函数调用
| 序号 | 函数名 | 说明 |
| :-: | :-: | :- |
| 1 | lstInit | _库函数：初始化链表_ |
| 2 | lstAdd | _库函数：向链表添加节点_ |
| 3 | lstFirst | _库函数：找到链表首节点地址_ |
| 4 | lstLast | _库函数：找到链表尾节点地址_ |
| 5 | init_can0 | 初始化CAN0总线 |
| 6 | init_can1 | 初始化CAN1总线 |
| 7 | taskDelay | _库函数：延时_ |
| 8 | msgQReceive | _库函数：接收消息队列_ |
| 9 | lstPrevious | _库函数：找到前一个节点_ |
| 10 | taskSuspend | _库函数：任务挂起_ |

```mermaid
graph TB
      开始((开始))-->寄存器正常{中断和状态寄存器正常}
      寄存器正常--YES-->扩展{是扩展数据帧}
      寄存器正常--NO-->释放接收缓冲器
      扩展--YES-->接收数据并拷贝到缓冲链表中
      扩展--NO-->释放接收缓冲器
      接收数据并拷贝到缓冲链表中-->数据{收到的ID和数据正确}
      数据--YES-->加入时标
      数据--NO-->释放接收缓冲器
      加入时标-->发送到相应的消息队列
      发送到相应的消息队列-->游标指向下一个节点
      游标指向下一个节点-->释放接收缓冲器
      释放接收缓冲器-->结束((结束))
```
## void isr_rx_can0(void) {} / ## void isr_rx_can1(void) {}

### 局部变量定义

| 序号 | 变量名 | 说明 |
| :-: | :-: | :- |
| 1 | send | 自身的任务ID和发送数据的首地址 |

### 函数调用
| 序号 | 函数名 | 说明 |
| :-: | :-: | :- |
| 1 | tickGet | _库函数：获取内核时钟计数值_ |
| 2 | msgQSend | _库函数：发送消息队列_ |
| 3 | lstNext | _库函数：找到下一个节点地址_ |

## void init_can0(void) {} / void init_can1(void) {}

### 函数调用
| 序号 | 函数名 | 说明 |
| :-: | :-: | :- |
| 1 | sysIntDisablePIC | _库函数：系统中断失能_ |
| 2 | intConnect | _库函数：中断绑定_ |
| 3 | sysIntEnablePIC | _库函数：系统中断使能_ |
