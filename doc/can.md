# t_can()

```c
void                 /* 无返回值 */
t_can(               /* CAN通信任务 */
        int addr,    /* CAN总线基地址表 */
        int irq,     /* CAN总线中断号表 */
        int n,       /* CAN总线数量 */
        int period,  /* 任务运行周期 */
        int duration /* CAN总线接收缓冲链表长度 */
)
```

```mermaid
graph TB
        延时-->状态正常{状态寄存器正常}
        开始((开始))-->构建缓冲链表
        构建缓冲链表-->硬件初始化
        硬件初始化-->主循环开始
        主循环开始-->延时
        状态正常--YES-->为空{消息队列为空}
        状态正常--NO-->重新初始化硬件
        重新初始化硬件-->主循环开始
        为空--YES-->已满{缓冲链表已满}
        为空--NO-->向总线发送
        向总线发送-->已满
        已满--YES-->小于10s{缓冲累积时间小于10s}
        已满--NO-->总线负载率正常
        小于10s--YES-->总线负载率过高
        小于10s--NO-->总线负载率正常
        总线负载率正常-->主循环开始
        总线负载率过高-->主循环开始
```
# isr_rx_can0()
# isr_rx_can1()

```c
static void      /* 无返回值 */
isr_rx_can0(     /* CAN总线0接收中断服务程序 */
        int addr /* CAN总线0基地址 */
);

static void      /* 无返回值 */
isr_rx_can1(     /* CAN总线1接收中断服务程序 */
        int addr /* CAN总线1基地址 */
);
```

```mermaid
graph TB
        开始((开始))-->寄存器正常{中断和状态寄存器正常}
        寄存器正常--YES-->扩展{是扩展数据帧}
        寄存器正常--NO-->释放接收缓冲器
        扩展--YES-->接收数据并拷贝到缓冲链表中
        扩展--NO-->释放接收缓冲器
        接收数据并拷贝到缓冲链表中-->数据{收到的ID和数据正确}
        数据--YES-->加入时标
        数据--NO-->释放接收缓冲器
        加入时标-->发送到相应的消息队列
        发送到相应的消息队列-->游标指向下一个节点
        游标指向下一个节点-->释放接收缓冲器
        释放接收缓冲器-->结束((结束))
```

# init_can()

```c
static void        /* 无返回值 */
init_can(
        int *addr, /* CAN总线基地址表 */
        int *irq,  /* CAN总线中断号表 */
        int cable  /* 总线编号 */
)
```
